#pragma once

#include <vector>
#include <Eigen/Dense>

void constructM_N3(const std::vector<Eigen::MatrixXd> &a, const std::vector<Eigen::VectorXd> &b, const std::vector<double> &c, const Eigen::VectorXd& u, Eigen::MatrixXd& M) {
    M(0,0) = u(0);
    M(0,1) = u(1);
    M(0,2) = u(2);
    M(0,3) = u(3);
    M(1,1) = u(0);
    M(1,4) = u(2);
    M(1,5) = u(3);
    M(1,12) = u(1);
    M(2,2) = u(0);
    M(2,4) = u(1);
    M(2,6) = u(3);
    M(2,21) = u(2);
    M(3,3) = u(0);
    M(3,5) = u(1);
    M(3,6) = u(2);
    M(3,31) = u(3);
    M(4,4) = u(0);
    M(4,7) = u(3);
    M(4,8) = u(1);
    M(4,17) = u(2);
    M(5,5) = u(0);
    M(5,7) = u(2);
    M(5,9) = u(1);
    M(5,27) = u(3);
    M(6,6) = u(0);
    M(6,7) = u(1);
    M(6,19) = u(2);
    M(6,29) = u(3);
    M(7,7) = u(0);
    M(7,15) = u(1);
    M(7,24) = u(2);
    M(7,34) = u(3);
    M(8,2) = 1*c[0];
    M(8,4) = 1*b[0](0);
    M(8,6) = 1*b[0](2);
    M(8,7) = 1*a[0](0,2) + 1*a[0](2,0);
    M(8,8) = 1*a[0](0,0);
    M(8,17) = 1*a[0](0,1) + 1*a[0](1,0);
    M(8,19) = 1*a[0](1,2) + 1*a[0](2,1);
    M(8,21) = 1*b[0](1);
    M(8,22) = 1*a[0](1,1);
    M(8,29) = 1*a[0](2,2);
    M(9,3) = 1*c[0];
    M(9,5) = 1*b[0](0);
    M(9,6) = 1*b[0](1);
    M(9,7) = 1*a[0](0,1) + 1*a[0](1,0);
    M(9,9) = 1*a[0](0,0);
    M(9,19) = 1*a[0](1,1);
    M(9,27) = 1*a[0](0,2) + 1*a[0](2,0);
    M(9,29) = 1*a[0](1,2) + 1*a[0](2,1);
    M(9,31) = 1*b[0](2);
    M(9,32) = 1*a[0](2,2);
    M(10,4) = 1*c[0];
    M(10,7) = 1*b[0](2);
    M(10,8) = 1*b[0](0);
    M(10,10) = 1*a[0](0,0);
    M(10,15) = 1*a[0](0,2) + 1*a[0](2,0);
    M(10,16) = 1*a[0](0,1) + 1*a[0](1,0);
    M(10,17) = 1*b[0](1);
    M(10,18) = 1*a[0](1,1);
    M(10,24) = 1*a[0](1,2) + 1*a[0](2,1);
    M(10,34) = 1*a[0](2,2);
    M(11,5) = 1*c[0];
    M(11,7) = 1*b[0](1);
    M(11,9) = 1*b[0](0);
    M(11,11) = 1*a[0](0,0);
    M(11,15) = 1*a[0](0,1) + 1*a[0](1,0);
    M(11,24) = 1*a[0](1,1);
    M(11,25) = 1*a[0](0,2) + 1*a[0](2,0);
    M(11,27) = 1*b[0](2);
    M(11,28) = 1*a[0](2,2);
    M(11,34) = 1*a[0](1,2) + 1*a[0](2,1);
    M(12,0) = 1*c[0];
    M(12,1) = 1*b[0](0);
    M(12,2) = 1*b[0](1);
    M(12,3) = 1*b[0](2);
    M(12,4) = 1*a[0](0,1) + 1*a[0](1,0);
    M(12,5) = 1*a[0](0,2) + 1*a[0](2,0);
    M(12,6) = 1*a[0](1,2) + 1*a[0](2,1);
    M(12,12) = 1*a[0](0,0);
    M(12,21) = 1*a[0](1,1);
    M(12,31) = 1*a[0](2,2);
    M(13,1) = 1*c[0];
    M(13,4) = 1*b[0](1);
    M(13,5) = 1*b[0](2);
    M(13,7) = 1*a[0](1,2) + 1*a[0](2,1);
    M(13,8) = 1*a[0](0,1) + 1*a[0](1,0);
    M(13,9) = 1*a[0](0,2) + 1*a[0](2,0);
    M(13,12) = 1*b[0](0);
    M(13,13) = 1*a[0](0,0);
    M(13,17) = 1*a[0](1,1);
    M(13,27) = 1*a[0](2,2);
    M(14,8) = 1*b[0](1);
    M(14,9) = 1*b[0](2);
    M(14,10) = 1*a[0](0,1) + 1*a[0](1,0);
    M(14,11) = 1*a[0](0,2) + 1*a[0](2,0);
    M(14,12) = 1*c[0];
    M(14,13) = 1*b[0](0);
    M(14,14) = 1*a[0](0,0);
    M(14,15) = 1*a[0](1,2) + 1*a[0](2,1);
    M(14,16) = 1*a[0](1,1);
    M(14,25) = 1*a[0](2,2);
    M(15,6) = 1*c[0];
    M(15,7) = 1*b[0](0);
    M(15,15) = 1*a[0](0,0);
    M(15,19) = 1*b[0](1);
    M(15,20) = 1*a[0](1,1);
    M(15,24) = 1*a[0](0,1) + 1*a[0](1,0);
    M(15,26) = 1*a[0](1,2) + 1*a[0](2,1);
    M(15,29) = 1*b[0](2);
    M(15,30) = 1*a[0](2,2);
    M(15,34) = 1*a[0](0,2) + 1*a[0](2,0);
    M(16,8) = 1*b[1](1);
    M(16,9) = 1*b[1](2);
    M(16,10) = 1*a[1](0,1) + 1*a[1](1,0);
    M(16,11) = 1*a[1](0,2) + 1*a[1](2,0);
    M(16,12) = 1*c[1];
    M(16,13) = 1*b[1](0);
    M(16,14) = 1*a[1](0,0);
    M(16,15) = 1*a[1](1,2) + 1*a[1](2,1);
    M(16,16) = 1*a[1](1,1);
    M(16,25) = 1*a[1](2,2);
    M(17,1) = 1*c[1];
    M(17,4) = 1*b[1](1);
    M(17,5) = 1*b[1](2);
    M(17,7) = 1*a[1](1,2) + 1*a[1](2,1);
    M(17,8) = 1*a[1](0,1) + 1*a[1](1,0);
    M(17,9) = 1*a[1](0,2) + 1*a[1](2,0);
    M(17,12) = 1*b[1](0);
    M(17,13) = 1*a[1](0,0);
    M(17,17) = 1*a[1](1,1);
    M(17,27) = 1*a[1](2,2);
    M(18,4) = 1*c[1];
    M(18,7) = 1*b[1](2);
    M(18,8) = 1*b[1](0);
    M(18,10) = 1*a[1](0,0);
    M(18,15) = 1*a[1](0,2) + 1*a[1](2,0);
    M(18,16) = 1*a[1](0,1) + 1*a[1](1,0);
    M(18,17) = 1*b[1](1);
    M(18,18) = 1*a[1](1,1);
    M(18,24) = 1*a[1](1,2) + 1*a[1](2,1);
    M(18,34) = 1*a[1](2,2);
    M(19,3) = 1*c[1];
    M(19,5) = 1*b[1](0);
    M(19,6) = 1*b[1](1);
    M(19,7) = 1*a[1](0,1) + 1*a[1](1,0);
    M(19,9) = 1*a[1](0,0);
    M(19,19) = 1*a[1](1,1);
    M(19,27) = 1*a[1](0,2) + 1*a[1](2,0);
    M(19,29) = 1*a[1](1,2) + 1*a[1](2,1);
    M(19,31) = 1*b[1](2);
    M(19,32) = 1*a[1](2,2);
    M(20,6) = 1*c[1];
    M(20,7) = 1*b[1](0);
    M(20,15) = 1*a[1](0,0);
    M(20,19) = 1*b[1](1);
    M(20,20) = 1*a[1](1,1);
    M(20,24) = 1*a[1](0,1) + 1*a[1](1,0);
    M(20,26) = 1*a[1](1,2) + 1*a[1](2,1);
    M(20,29) = 1*b[1](2);
    M(20,30) = 1*a[1](2,2);
    M(20,34) = 1*a[1](0,2) + 1*a[1](2,0);
    M(21,0) = 1*c[1];
    M(21,1) = 1*b[1](0);
    M(21,2) = 1*b[1](1);
    M(21,3) = 1*b[1](2);
    M(21,4) = 1*a[1](0,1) + 1*a[1](1,0);
    M(21,5) = 1*a[1](0,2) + 1*a[1](2,0);
    M(21,6) = 1*a[1](1,2) + 1*a[1](2,1);
    M(21,12) = 1*a[1](0,0);
    M(21,21) = 1*a[1](1,1);
    M(21,31) = 1*a[1](2,2);
    M(22,2) = 1*c[1];
    M(22,4) = 1*b[1](0);
    M(22,6) = 1*b[1](2);
    M(22,7) = 1*a[1](0,2) + 1*a[1](2,0);
    M(22,8) = 1*a[1](0,0);
    M(22,17) = 1*a[1](0,1) + 1*a[1](1,0);
    M(22,19) = 1*a[1](1,2) + 1*a[1](2,1);
    M(22,21) = 1*b[1](1);
    M(22,22) = 1*a[1](1,1);
    M(22,29) = 1*a[1](2,2);
    M(23,16) = 1*a[1](0,0);
    M(23,17) = 1*b[1](0);
    M(23,18) = 1*a[1](0,1) + 1*a[1](1,0);
    M(23,19) = 1*b[1](2);
    M(23,20) = 1*a[1](1,2) + 1*a[1](2,1);
    M(23,21) = 1*c[1];
    M(23,22) = 1*b[1](1);
    M(23,23) = 1*a[1](1,1);
    M(23,24) = 1*a[1](0,2) + 1*a[1](2,0);
    M(23,26) = 1*a[1](2,2);
    M(24,5) = 1*c[1];
    M(24,7) = 1*b[1](1);
    M(24,9) = 1*b[1](0);
    M(24,11) = 1*a[1](0,0);
    M(24,15) = 1*a[1](0,1) + 1*a[1](1,0);
    M(24,24) = 1*a[1](1,1);
    M(24,25) = 1*a[1](0,2) + 1*a[1](2,0);
    M(24,27) = 1*b[1](2);
    M(24,28) = 1*a[1](2,2);
    M(24,34) = 1*a[1](1,2) + 1*a[1](2,1);
    M(25,8) = 1*b[2](1);
    M(25,9) = 1*b[2](2);
    M(25,10) = 1*a[2](0,1) + 1*a[2](1,0);
    M(25,11) = 1*a[2](0,2) + 1*a[2](2,0);
    M(25,12) = 1*c[2];
    M(25,13) = 1*b[2](0);
    M(25,14) = 1*a[2](0,0);
    M(25,15) = 1*a[2](1,2) + 1*a[2](2,1);
    M(25,16) = 1*a[2](1,1);
    M(25,25) = 1*a[2](2,2);
    M(26,16) = 1*a[2](0,0);
    M(26,17) = 1*b[2](0);
    M(26,18) = 1*a[2](0,1) + 1*a[2](1,0);
    M(26,19) = 1*b[2](2);
    M(26,20) = 1*a[2](1,2) + 1*a[2](2,1);
    M(26,21) = 1*c[2];
    M(26,22) = 1*b[2](1);
    M(26,23) = 1*a[2](1,1);
    M(26,24) = 1*a[2](0,2) + 1*a[2](2,0);
    M(26,26) = 1*a[2](2,2);
    M(27,1) = 1*c[2];
    M(27,4) = 1*b[2](1);
    M(27,5) = 1*b[2](2);
    M(27,7) = 1*a[2](1,2) + 1*a[2](2,1);
    M(27,8) = 1*a[2](0,1) + 1*a[2](1,0);
    M(27,9) = 1*a[2](0,2) + 1*a[2](2,0);
    M(27,12) = 1*b[2](0);
    M(27,13) = 1*a[2](0,0);
    M(27,17) = 1*a[2](1,1);
    M(27,27) = 1*a[2](2,2);
    M(28,5) = 1*c[2];
    M(28,7) = 1*b[2](1);
    M(28,9) = 1*b[2](0);
    M(28,11) = 1*a[2](0,0);
    M(28,15) = 1*a[2](0,1) + 1*a[2](1,0);
    M(28,24) = 1*a[2](1,1);
    M(28,25) = 1*a[2](0,2) + 1*a[2](2,0);
    M(28,27) = 1*b[2](2);
    M(28,28) = 1*a[2](2,2);
    M(28,34) = 1*a[2](1,2) + 1*a[2](2,1);
    M(29,2) = 1*c[2];
    M(29,4) = 1*b[2](0);
    M(29,6) = 1*b[2](2);
    M(29,7) = 1*a[2](0,2) + 1*a[2](2,0);
    M(29,8) = 1*a[2](0,0);
    M(29,17) = 1*a[2](0,1) + 1*a[2](1,0);
    M(29,19) = 1*a[2](1,2) + 1*a[2](2,1);
    M(29,21) = 1*b[2](1);
    M(29,22) = 1*a[2](1,1);
    M(29,29) = 1*a[2](2,2);
    M(30,6) = 1*c[2];
    M(30,7) = 1*b[2](0);
    M(30,15) = 1*a[2](0,0);
    M(30,19) = 1*b[2](1);
    M(30,20) = 1*a[2](1,1);
    M(30,24) = 1*a[2](0,1) + 1*a[2](1,0);
    M(30,26) = 1*a[2](1,2) + 1*a[2](2,1);
    M(30,29) = 1*b[2](2);
    M(30,30) = 1*a[2](2,2);
    M(30,34) = 1*a[2](0,2) + 1*a[2](2,0);
    M(31,0) = 1*c[2];
    M(31,1) = 1*b[2](0);
    M(31,2) = 1*b[2](1);
    M(31,3) = 1*b[2](2);
    M(31,4) = 1*a[2](0,1) + 1*a[2](1,0);
    M(31,5) = 1*a[2](0,2) + 1*a[2](2,0);
    M(31,6) = 1*a[2](1,2) + 1*a[2](2,1);
    M(31,12) = 1*a[2](0,0);
    M(31,21) = 1*a[2](1,1);
    M(31,31) = 1*a[2](2,2);
    M(32,3) = 1*c[2];
    M(32,5) = 1*b[2](0);
    M(32,6) = 1*b[2](1);
    M(32,7) = 1*a[2](0,1) + 1*a[2](1,0);
    M(32,9) = 1*a[2](0,0);
    M(32,19) = 1*a[2](1,1);
    M(32,27) = 1*a[2](0,2) + 1*a[2](2,0);
    M(32,29) = 1*a[2](1,2) + 1*a[2](2,1);
    M(32,31) = 1*b[2](2);
    M(32,32) = 1*a[2](2,2);
    M(33,25) = 1*a[2](0,0);
    M(33,26) = 1*a[2](1,1);
    M(33,27) = 1*b[2](0);
    M(33,28) = 1*a[2](0,2) + 1*a[2](2,0);
    M(33,29) = 1*b[2](1);
    M(33,30) = 1*a[2](1,2) + 1*a[2](2,1);
    M(33,31) = 1*c[2];
    M(33,32) = 1*b[2](2);
    M(33,33) = 1*a[2](2,2);
    M(33,34) = 1*a[2](0,1) + 1*a[2](1,0);
    M(34,4) = 1*c[2];
    M(34,7) = 1*b[2](2);
    M(34,8) = 1*b[2](0);
    M(34,10) = 1*a[2](0,0);
    M(34,15) = 1*a[2](0,2) + 1*a[2](2,0);
    M(34,16) = 1*a[2](0,1) + 1*a[2](1,0);
    M(34,17) = 1*b[2](1);
    M(34,18) = 1*a[2](1,1);
    M(34,24) = 1*a[2](1,2) + 1*a[2](2,1);
    M(34,34) = 1*a[2](2,2);
}